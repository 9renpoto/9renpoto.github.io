<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[:-)]]></title><description><![CDATA[lazy buld suspicious note]]></description><link>https://9renpoto.github.io</link><generator>RSS for Node</generator><lastBuildDate>Thu, 19 Oct 2017 05:47:38 GMT</lastBuildDate><item><title><![CDATA[SPAとInitial State]]></title><description><![CDATA[TL;DR 誰か初期状態を持っているのかはっきりする 初期状態が定義されるタイミングを考慮する SPAの鬼門は   管理であるといって過言はない。 今回は初期状態について現在考えていることをメモする。 前提 URLはRestとする ページ内から幾つかのAPI…]]></description><link>https://9renpoto.github.io/entry/2017/10/18/spa-initial-state/</link><guid isPermaLink="false">https://9renpoto.github.io/entry/2017/10/18/spa-initial-state/</guid><pubDate>Wed, 18 Oct 2017 04:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;TL;DR&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;誰か初期状態を持っているのかはっきりする&lt;/li&gt;
&lt;li&gt;初期状態が定義されるタイミングを考慮する&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;SPAの鬼門は &lt;code&gt;State&lt;/code&gt; 管理であるといって過言はない。&lt;/p&gt;
&lt;p&gt;今回は初期状態について現在考えていることをメモする。&lt;/p&gt;
&lt;h2&gt;前提&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;URLはRestとする&lt;/li&gt;
&lt;li&gt;ページ内から幾つかのAPIにアクセスする&lt;/li&gt;
&lt;li&gt;内部は複数のURLからなるSPAで構成されている&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;自分が設けている前提&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;同一URLを表示したときには同一のAPIリクエストが発行されるべきである&lt;/li&gt;
&lt;li&gt;または期待される結果が同一である（後述）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;APIリクエストの組み立てに必要な状態&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;location.href&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;初期状態&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;例&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://www.airbnb.com/s/paris/all&quot;&gt;https://www.airbnb.com/s/paris/all&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;parisの宿を探す、一覧が出て来る&lt;/li&gt;
&lt;li&gt;ただ、このURLには &lt;strong&gt;暗黙的に今日以降&lt;/strong&gt; という日付範囲が適応されている&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://www.airbnb.com/s/paris/all?checkin=2017-10-26&amp;#x26;checkout=2017-10-28&quot;&gt;https://www.airbnb.com/s/paris/all?checkin=2017-10-26&amp;#x26;checkout=2017-10-28&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;checkin, checkoutの範囲を指定する&lt;/li&gt;
&lt;li&gt;カレンダーに適応した日付の範囲と、その範囲内で検索できた対象の宿が表示される&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;SPAと状態&lt;/h2&gt;
&lt;p&gt;airbnbのようなカレンダーのような絞込みを提供している機能のことを考える。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;SPAが初期状態を持つ場合&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;初期状態はJavaScriptがダウンロードされた際に決まる（今回は遅延で初期状態を定義することを除く）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;URLとSPAの状態が乖離する場合を考える&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;カレンダーの操作をしているが確定処理を行っていない&lt;/li&gt;
&lt;li&gt;画面には途中経過が表示されている（SPAのstateは更新されている）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;初期状態がURLにあるとする場合&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SPAに流入しJavaScriptがダウンロードされたタイミングと同一とは限らない&lt;/li&gt;
&lt;li&gt;上記の場合、期待しない初期状態からクエリを発行するため期待と矛盾する&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;状態の整合性を取る&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;遷移をした場合に状態の整合性をとるactionを &lt;code&gt;onUpdate&lt;/code&gt; に書く場合&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;locationを引数として状態更新のアクションがもう1回Fluxを回る&lt;/li&gt;
&lt;li&gt;&lt;code&gt;upUpdate&lt;/code&gt; で再度整合性チェック、必要があればデータ更新&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;不必要なURLとstateの整合性を取るための再帰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不採用&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;考えた選択肢&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;検索条件をサーバから受け取り、検索条件表示と結果の乖離をなくす&lt;/li&gt;
&lt;li&gt;初期状態の定義をURLから生成できるよう、参照する状態の初期化を遅延する&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;reduxの場合、後者の方法はわからなかった。&lt;/p&gt;
&lt;h2&gt;まとめ&lt;/h2&gt;
&lt;p&gt;日本語難しい。&lt;/p&gt;
&lt;p&gt;Happy Hacking!&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://media.giphy.com/media/rSdzP7VZgI80w/giphy.gif&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;</content:encoded></item></channel></rss>