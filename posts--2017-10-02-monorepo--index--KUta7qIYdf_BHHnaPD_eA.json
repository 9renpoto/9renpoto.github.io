{"data":{"title":"複数環境構築のためにLernaを使う、が","date":"2017-10-02T02:00:00.000Z","permalink":"/entry/2017/10/02/monorepo/","_entry":"posts/2017-10-02-monorepo/index.md","page":"post","name":"index","category":"2017-10-02-monorepo","url":"/entry/2017/10/02/monorepo/"},"content":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"TL;DR","position":{"start":{"line":1,"column":3,"offset":2},"end":{"line":1,"column":8,"offset":7}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":8,"offset":7}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"期待通りに動かない","position":{"start":{"line":3,"column":3,"offset":11},"end":{"line":3,"column":12,"offset":20}}}],"position":{"start":{"line":3,"column":1,"offset":9},"end":{"line":3,"column":12,"offset":20}}},{"type":"text","value":"\n"}],"position":{"start":{"line":3,"column":1,"offset":9},"end":{"line":3,"column":12,"offset":20}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"npm or yarn","position":{"start":{"line":5,"column":4,"offset":25},"end":{"line":5,"column":15,"offset":36}}}],"position":{"start":{"line":5,"column":1,"offset":22},"end":{"line":5,"column":15,"offset":36}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"npmClientを指定できるようだが、yarnを指定すると永遠にインストールが終わらない問題に出くわす","position":{"start":{"line":7,"column":3,"offset":40},"end":{"line":7,"column":55,"offset":92}}}],"position":{"start":{"line":7,"column":3,"offset":40},"end":{"line":7,"column":55,"offset":92}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://travis-ci.org/9renpoto/eslint-config/builds/281805776"},"children":[{"type":"text","value":"https://travis-ci.org/9renpoto/eslint-config/builds/281805776","position":{"start":{"line":8,"column":6,"offset":98},"end":{"line":8,"column":67,"offset":159}}}],"position":{"start":{"line":8,"column":5,"offset":97},"end":{"line":8,"column":68,"offset":160}}}],"position":{"start":{"line":8,"column":3,"offset":95},"end":{"line":8,"column":68,"offset":160}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"concurrency=1"}],"position":{"start":{"line":9,"column":5,"offset":165},"end":{"line":9,"column":20,"offset":180}}},{"type":"text","value":" を指定するなど試すもretryしてやっと動く程度","position":{"start":{"line":9,"column":20,"offset":180},"end":{"line":9,"column":45,"offset":205}}}],"position":{"start":{"line":9,"column":5,"offset":165},"end":{"line":9,"column":45,"offset":205}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"期待するportに接続できていない？","position":{"start":{"line":10,"column":7,"offset":212},"end":{"line":10,"column":25,"offset":230}}}],"position":{"start":{"line":10,"column":5,"offset":210},"end":{"line":10,"column":25,"offset":230}}},{"type":"text","value":"\n"}],"position":{"start":{"line":10,"column":5,"offset":210},"end":{"line":10,"column":25,"offset":230}}},{"type":"text","value":"\n"}],"position":{"start":{"line":9,"column":3,"offset":163},"end":{"line":10,"column":25,"offset":230}}},{"type":"text","value":"\n"}],"position":{"start":{"line":8,"column":3,"offset":95},"end":{"line":10,"column":25,"offset":230}}},{"type":"text","value":"\n"}],"position":{"start":{"line":7,"column":1,"offset":38},"end":{"line":10,"column":25,"offset":230}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"npm v5","position":{"start":{"line":11,"column":3,"offset":233},"end":{"line":11,"column":9,"offset":239}}}],"position":{"start":{"line":11,"column":3,"offset":233},"end":{"line":11,"column":9,"offset":239}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"何故かlernaを通してやると ","position":{"start":{"line":12,"column":5,"offset":244},"end":{"line":12,"column":21,"offset":260}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"dependencies"}],"position":{"start":{"line":12,"column":21,"offset":260},"end":{"line":12,"column":35,"offset":274}}},{"type":"text","value":" がrootに展開されず見つからない場合がある","position":{"start":{"line":12,"column":35,"offset":274},"end":{"line":12,"column":58,"offset":297}}}],"position":{"start":{"line":12,"column":3,"offset":242},"end":{"line":12,"column":58,"offset":297}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ディレクトリ直下でやると問題ない場合がある","position":{"start":{"line":13,"column":5,"offset":302},"end":{"line":13,"column":26,"offset":323}}}],"position":{"start":{"line":13,"column":5,"offset":302},"end":{"line":13,"column":26,"offset":323}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"バグっている気持ち","position":{"start":{"line":14,"column":7,"offset":330},"end":{"line":14,"column":16,"offset":339}}}],"position":{"start":{"line":14,"column":5,"offset":328},"end":{"line":14,"column":16,"offset":339}}},{"type":"text","value":"\n"}],"position":{"start":{"line":14,"column":5,"offset":328},"end":{"line":14,"column":16,"offset":339}}},{"type":"text","value":"\n"}],"position":{"start":{"line":13,"column":3,"offset":300},"end":{"line":14,"column":16,"offset":339}}},{"type":"text","value":"\n"}],"position":{"start":{"line":12,"column":3,"offset":242},"end":{"line":14,"column":16,"offset":339}}},{"type":"text","value":"\n"}],"position":{"start":{"line":11,"column":1,"offset":231},"end":{"line":14,"column":16,"offset":339}}},{"type":"text","value":"\n"}],"position":{"start":{"line":7,"column":1,"offset":38},"end":{"line":14,"column":16,"offset":339}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"lerna bootstrap","position":{"start":{"line":16,"column":4,"offset":344},"end":{"line":16,"column":19,"offset":359}}}],"position":{"start":{"line":16,"column":1,"offset":341},"end":{"line":16,"column":19,"offset":359}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"共通packageとは、本当はディレクトリ直下で行いたいができていないようにみえる","position":{"start":{"line":18,"column":3,"offset":363},"end":{"line":18,"column":44,"offset":404}}}],"position":{"start":{"line":18,"column":3,"offset":363},"end":{"line":18,"column":44,"offset":404}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"lerna version 2.2.0","position":{"start":{"line":19,"column":5,"offset":409},"end":{"line":19,"column":24,"offset":428}}}],"position":{"start":{"line":19,"column":3,"offset":407},"end":{"line":19,"column":24,"offset":428}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"結局複数installを求められるものがある？","position":{"start":{"line":20,"column":5,"offset":433},"end":{"line":20,"column":28,"offset":456}}}],"position":{"start":{"line":20,"column":5,"offset":433},"end":{"line":20,"column":28,"offset":456}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"eslint","position":{"start":{"line":21,"column":7,"offset":463},"end":{"line":21,"column":13,"offset":469}}}],"position":{"start":{"line":21,"column":5,"offset":461},"end":{"line":21,"column":13,"offset":469}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"typescript","position":{"start":{"line":22,"column":7,"offset":476},"end":{"line":22,"column":17,"offset":486}}}],"position":{"start":{"line":22,"column":5,"offset":474},"end":{"line":22,"column":17,"offset":486}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"flow-bin","position":{"start":{"line":23,"column":7,"offset":493},"end":{"line":23,"column":15,"offset":501}}}],"position":{"start":{"line":23,"column":5,"offset":491},"end":{"line":23,"column":15,"offset":501}}},{"type":"text","value":"\n"}],"position":{"start":{"line":21,"column":5,"offset":461},"end":{"line":23,"column":15,"offset":501}}},{"type":"text","value":"\n"}],"position":{"start":{"line":20,"column":3,"offset":431},"end":{"line":23,"column":15,"offset":501}}},{"type":"text","value":"\n"}],"position":{"start":{"line":19,"column":3,"offset":407},"end":{"line":23,"column":15,"offset":501}}},{"type":"text","value":"\n"}],"position":{"start":{"line":18,"column":1,"offset":361},"end":{"line":23,"column":15,"offset":501}}},{"type":"text","value":"\n"}],"position":{"start":{"line":18,"column":1,"offset":361},"end":{"line":23,"column":15,"offset":501}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"まとめ","position":{"start":{"line":25,"column":4,"offset":506},"end":{"line":25,"column":7,"offset":509}}}],"position":{"start":{"line":25,"column":1,"offset":503},"end":{"line":25,"column":7,"offset":509}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"原因は調べきれていないが、lernaが原因で使えていない問題はいろいろありそう","position":{"start":{"line":27,"column":3,"offset":513},"end":{"line":27,"column":42,"offset":552}}}],"position":{"start":{"line":27,"column":3,"offset":513},"end":{"line":27,"column":42,"offset":552}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"issueは200以上ある","position":{"start":{"line":28,"column":5,"offset":557},"end":{"line":28,"column":18,"offset":570}}}],"position":{"start":{"line":28,"column":3,"offset":555},"end":{"line":28,"column":18,"offset":570}}},{"type":"text","value":"\n"}],"position":{"start":{"line":28,"column":3,"offset":555},"end":{"line":28,"column":18,"offset":570}}},{"type":"text","value":"\n"}],"position":{"start":{"line":27,"column":1,"offset":511},"end":{"line":28,"column":18,"offset":570}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"早めに地雷を踏んでおく","position":{"start":{"line":29,"column":3,"offset":573},"end":{"line":29,"column":14,"offset":584}}}],"position":{"start":{"line":29,"column":1,"offset":571},"end":{"line":29,"column":14,"offset":584}}},{"type":"text","value":"\n"}],"position":{"start":{"line":27,"column":1,"offset":511},"end":{"line":29,"column":14,"offset":584}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"http://3.bp.blogspot.com/-R1W3888HcbU/V9ppr9A_NHI/AAAAAAAA9wE/CuzJ-JfOQz8Ht6w-jNN79_vh6-TeVOGNACLcB/s800/jirai_tanchiki_man.png","alt":"image"},"children":[],"position":{"start":{"line":31,"column":1,"offset":586},"end":{"line":31,"column":138,"offset":723}}}],"position":{"start":{"line":31,"column":1,"offset":586},"end":{"line":31,"column":138,"offset":723}}}],"data":{"quirksMode":false},"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}}},"raw":"# TL;DR\n\n- 期待通りに動かない\n\n## npm or yarn\n\n- npmClientを指定できるようだが、yarnを指定すると永遠にインストールが終わらない問題に出くわす\n  - <https://travis-ci.org/9renpoto/eslint-config/builds/281805776>\n  - `concurrency=1` を指定するなど試すもretryしてやっと動く程度\n    - 期待するportに接続できていない？\n- npm v5\n  - 何故かlernaを通してやると `dependencies` がrootに展開されず見つからない場合がある\n  - ディレクトリ直下でやると問題ない場合がある\n    - バグっている気持ち\n\n## lerna bootstrap\n\n- 共通packageとは、本当はディレクトリ直下で行いたいができていないようにみえる\n  - lerna version 2.2.0\n  - 結局複数installを求められるものがある？\n    - eslint\n    - typescript\n    - flow-bin\n\n## まとめ\n\n- 原因は調べきれていないが、lernaが原因で使えていない問題はいろいろありそう\n  - issueは200以上ある\n- 早めに地雷を踏んでおく\n\n![image](http://3.bp.blogspot.com/-R1W3888HcbU/V9ppr9A_NHI/AAAAAAAA9wE/CuzJ-JfOQz8Ht6w-jNN79_vh6-TeVOGNACLcB/s800/jirai_tanchiki_man.png)\n"}