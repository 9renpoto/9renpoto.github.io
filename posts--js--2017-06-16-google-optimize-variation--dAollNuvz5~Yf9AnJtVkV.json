{"data":{"date":"2017-06-15T15:00:11.000Z","permalink":"/entry/2017/06/16/google-optimize-variation/","title":"google optimize を読む","category":"js","_entry":"posts/js/2017-06-16-google-optimize-variation.md","page":"post","name":"google-optimize-variation","url":"/entry/2017/06/16/google-optimize-variation/"},"content":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"TL;DR","position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":8,"offset":8}}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":8,"offset":8}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"google optimizeで今適応されているテストは何か調べた","position":{"start":{"line":4,"column":3,"offset":12},"end":{"line":4,"column":36,"offset":45}}}],"position":{"start":{"line":4,"column":1,"offset":10},"end":{"line":4,"column":36,"offset":45}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"テストの結果はfirst party cookie","position":{"start":{"line":5,"column":3,"offset":48},"end":{"line":5,"column":28,"offset":73}}}],"position":{"start":{"line":5,"column":1,"offset":46},"end":{"line":5,"column":28,"offset":73}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"_gaexp"}],"position":{"start":{"line":6,"column":3,"offset":76},"end":{"line":6,"column":11,"offset":84}}},{"type":"text","value":"という名前で記録されている","position":{"start":{"line":6,"column":11,"offset":84},"end":{"line":6,"column":24,"offset":97}}}],"position":{"start":{"line":6,"column":1,"offset":74},"end":{"line":6,"column":24,"offset":97}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"規約は読んで自己責任で参照しましょう","position":{"start":{"line":7,"column":5,"offset":102},"end":{"line":7,"column":23,"offset":120}}}],"position":{"start":{"line":7,"column":3,"offset":100},"end":{"line":7,"column":25,"offset":122}}}],"position":{"start":{"line":7,"column":1,"offset":98},"end":{"line":7,"column":25,"offset":122}}},{"type":"text","value":"\n"}],"position":{"start":{"line":4,"column":1,"offset":10},"end":{"line":7,"column":25,"offset":122}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"/static/google-optimize-logo.jpg","alt":"optimize"},"children":[],"position":{"start":{"line":9,"column":1,"offset":124},"end":{"line":9,"column":46,"offset":169}}}],"position":{"start":{"line":9,"column":1,"offset":124},"end":{"line":9,"column":46,"offset":169}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"軽く調べた結果","position":{"start":{"line":11,"column":4,"offset":174},"end":{"line":11,"column":11,"offset":181}}}],"position":{"start":{"line":11,"column":1,"offset":171},"end":{"line":11,"column":11,"offset":181}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage?hl=en#optimize"},"children":[{"type":"text","value":"公開情報","position":{"start":{"line":13,"column":4,"offset":186},"end":{"line":13,"column":8,"offset":190}}}],"position":{"start":{"line":13,"column":3,"offset":185},"end":{"line":13,"column":111,"offset":293}}}],"position":{"start":{"line":13,"column":3,"offset":185},"end":{"line":13,"column":111,"offset":293}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"_gaexp"}],"position":{"start":{"line":14,"column":5,"offset":298},"end":{"line":14,"column":13,"offset":306}}},{"type":"text","value":"という名前で記録されている","position":{"start":{"line":14,"column":13,"offset":306},"end":{"line":14,"column":26,"offset":319}}}],"position":{"start":{"line":14,"column":3,"offset":296},"end":{"line":14,"column":26,"offset":319}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cookieはデフォルト90日保存","position":{"start":{"line":15,"column":5,"offset":324},"end":{"line":15,"column":22,"offset":341}}}],"position":{"start":{"line":15,"column":3,"offset":322},"end":{"line":15,"column":22,"offset":341}}},{"type":"text","value":"\n"}],"position":{"start":{"line":14,"column":3,"offset":296},"end":{"line":15,"column":22,"offset":341}}},{"type":"text","value":"\n"}],"position":{"start":{"line":13,"column":1,"offset":183},"end":{"line":15,"column":22,"offset":341}}},{"type":"text","value":"\n"}],"position":{"start":{"line":13,"column":1,"offset":183},"end":{"line":15,"column":22,"offset":341}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"おそらく操作しているところ","position":{"start":{"line":17,"column":4,"offset":346},"end":{"line":17,"column":17,"offset":359}}}],"position":{"start":{"line":17,"column":1,"offset":343},"end":{"line":17,"column":17,"offset":359}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"m[0]"}],"position":{"start":{"line":19,"column":3,"offset":363},"end":{"line":19,"column":9,"offset":369}}},{"type":"text","value":" は ","position":{"start":{"line":19,"column":9,"offset":369},"end":{"line":19,"column":12,"offset":372}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"experimentid"}],"position":{"start":{"line":19,"column":12,"offset":372},"end":{"line":19,"column":26,"offset":386}}}],"position":{"start":{"line":19,"column":1,"offset":361},"end":{"line":19,"column":26,"offset":386}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"m[2]"}],"position":{"start":{"line":20,"column":3,"offset":389},"end":{"line":20,"column":9,"offset":395}}},{"type":"text","value":" がテストのパターンを表している","position":{"start":{"line":20,"column":9,"offset":395},"end":{"line":20,"column":25,"offset":411}}}],"position":{"start":{"line":20,"column":3,"offset":389},"end":{"line":20,"column":25,"offset":411}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cookieの一番最後のnumber","position":{"start":{"line":21,"column":5,"offset":416},"end":{"line":21,"column":23,"offset":434}}}],"position":{"start":{"line":21,"column":3,"offset":414},"end":{"line":21,"column":23,"offset":434}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"これだけだと ","position":{"start":{"line":22,"column":5,"offset":439},"end":{"line":22,"column":12,"offset":446}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"variationid"}],"position":{"start":{"line":22,"column":12,"offset":446},"end":{"line":22,"column":25,"offset":459}}},{"type":"text","value":" としては使えないので何かと複合してユニークになっている","position":{"start":{"line":22,"column":25,"offset":459},"end":{"line":22,"column":53,"offset":487}}}],"position":{"start":{"line":22,"column":3,"offset":437},"end":{"line":22,"column":53,"offset":487}}},{"type":"text","value":"\n"}],"position":{"start":{"line":21,"column":3,"offset":414},"end":{"line":22,"column":53,"offset":487}}},{"type":"text","value":"\n"}],"position":{"start":{"line":20,"column":1,"offset":387},"end":{"line":22,"column":53,"offset":487}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"m[1]"}],"position":{"start":{"line":23,"column":3,"offset":490},"end":{"line":23,"column":9,"offset":496}}},{"type":"text","value":" はnumberだが何の値かはすぐにはわからなかった","position":{"start":{"line":23,"column":9,"offset":496},"end":{"line":23,"column":35,"offset":522}}}],"position":{"start":{"line":23,"column":1,"offset":488},"end":{"line":23,"column":35,"offset":522}}},{"type":"text","value":"\n"}],"position":{"start":{"line":19,"column":1,"offset":361},"end":{"line":23,"column":35,"offset":522}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"Zg = function(a, b) {\n  const c = b.match(/GAX1\\.([^.]+).(.*)/);\n  if (c) {\n    let d;\n    a: {\n      const e = (c[1] || \"\").split(\"-\");\n      if (!(e.length == 0 || e.length > 2)) {\n        const f = ia(e[0]);\n        if (f.length != 0) {\n          const g = e.length == 2 ? ia(e[1]) : \"1\";\n          if (uf(f) && uf(g)) {\n            d = new Og(T(f), T(g));\n            break a;\n          }\n        }\n      }\n      d = void 0;\n    }\n    if (d) {\n      for (\n        var h = new Qg(d, a.qa, a.ha), k = (c[2] || \"\").split(\"!\"), l = 0;\n        l < k.length;\n        l++\n      ) {\n        const m = k[l].split(\".\");\n        if (m.length == 3) {\n          if (!uf(m[1])) {\n            return;\n          }\n          Ug(h, m[0], new Pg(m[2], T(m[1])));\n        }\n      }\n      return h;\n    }\n  }\n};\n"}],"position":{"start":{"line":25,"column":1,"offset":524},"end":{"line":62,"column":4,"offset":1328}}}],"position":{"start":{"line":25,"column":1,"offset":524},"end":{"line":62,"column":4,"offset":1328}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Extra","position":{"start":{"line":64,"column":4,"offset":1333},"end":{"line":64,"column":9,"offset":1338}}}],"position":{"start":{"line":64,"column":1,"offset":1330},"end":{"line":64,"column":9,"offset":1338}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://stackoverflow.com/questions/44412241/is-it-possible-to-read-experimentid-and-variationid-in-javascript-with-google-op"},"children":[{"type":"text","value":"stackoverflow","position":{"start":{"line":66,"column":4,"offset":1343},"end":{"line":66,"column":17,"offset":1356}}}],"position":{"start":{"line":66,"column":3,"offset":1342},"end":{"line":66,"column":145,"offset":1484}}}],"position":{"start":{"line":66,"column":3,"offset":1342},"end":{"line":66,"column":145,"offset":1484}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ABテストとしてJavaScriptが実行できるので、自分でユニークなIDを配信して実行されているテストを特定しましょう","position":{"start":{"line":67,"column":5,"offset":1489},"end":{"line":67,"column":65,"offset":1549}}}],"position":{"start":{"line":67,"column":3,"offset":1487},"end":{"line":67,"column":65,"offset":1549}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"リバースエンジニアリングして危ない道を渡るよりも現実的","position":{"start":{"line":68,"column":5,"offset":1554},"end":{"line":68,"column":32,"offset":1581}}}],"position":{"start":{"line":68,"column":3,"offset":1552},"end":{"line":68,"column":32,"offset":1581}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ちゃんとABテストの記録は計測できます、そうgoogle analyticsならね！","position":{"start":{"line":69,"column":5,"offset":1586},"end":{"line":69,"column":47,"offset":1628}}}],"position":{"start":{"line":69,"column":3,"offset":1584},"end":{"line":69,"column":47,"offset":1628}}},{"type":"text","value":"\n"}],"position":{"start":{"line":67,"column":3,"offset":1487},"end":{"line":69,"column":47,"offset":1628}}},{"type":"text","value":"\n"}],"position":{"start":{"line":66,"column":1,"offset":1340},"end":{"line":69,"column":47,"offset":1628}}},{"type":"text","value":"\n"}],"position":{"start":{"line":66,"column":1,"offset":1340},"end":{"line":69,"column":47,"offset":1628}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Happy Hacking!","position":{"start":{"line":71,"column":1,"offset":1630},"end":{"line":71,"column":15,"offset":1644}}}],"position":{"start":{"line":71,"column":1,"offset":1630},"end":{"line":71,"column":15,"offset":1644}}}],"data":{"quirksMode":false},"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}}},"raw":"\n# TL;DR\n\n- google optimizeで今適応されているテストは何か調べた\n- テストの結果はfirst party cookie\n- `_gaexp`という名前で記録されている\n- **規約は読んで自己責任で参照しましょう**\n\n![optimize](/static/google-optimize-logo.jpg)\n\n## 軽く調べた結果\n\n- [公開情報](https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage?hl=en#optimize)\n  - `_gaexp`という名前で記録されている\n  - cookieはデフォルト90日保存\n\n## おそらく操作しているところ\n\n- `m[0]` は `experimentid`\n- `m[2]` がテストのパターンを表している\n  - cookieの一番最後のnumber\n  - これだけだと `variationid` としては使えないので何かと複合してユニークになっている\n- `m[1]` はnumberだが何の値かはすぐにはわからなかった\n\n```js\nZg = function(a, b) {\n  const c = b.match(/GAX1\\.([^.]+).(.*)/);\n  if (c) {\n    let d;\n    a: {\n      const e = (c[1] || \"\").split(\"-\");\n      if (!(e.length == 0 || e.length > 2)) {\n        const f = ia(e[0]);\n        if (f.length != 0) {\n          const g = e.length == 2 ? ia(e[1]) : \"1\";\n          if (uf(f) && uf(g)) {\n            d = new Og(T(f), T(g));\n            break a;\n          }\n        }\n      }\n      d = void 0;\n    }\n    if (d) {\n      for (\n        var h = new Qg(d, a.qa, a.ha), k = (c[2] || \"\").split(\"!\"), l = 0;\n        l < k.length;\n        l++\n      ) {\n        const m = k[l].split(\".\");\n        if (m.length == 3) {\n          if (!uf(m[1])) {\n            return;\n          }\n          Ug(h, m[0], new Pg(m[2], T(m[1])));\n        }\n      }\n      return h;\n    }\n  }\n};\n```\n\n## Extra\n\n- [stackoverflow](https://stackoverflow.com/questions/44412241/is-it-possible-to-read-experimentid-and-variationid-in-javascript-with-google-op)\n  - ABテストとしてJavaScriptが実行できるので、自分でユニークなIDを配信して実行されているテストを特定しましょう\n  - リバースエンジニアリングして危ない道を渡るよりも現実的\n  - ちゃんとABテストの記録は計測できます、そうgoogle analyticsならね！\n\nHappy Hacking!\n"}