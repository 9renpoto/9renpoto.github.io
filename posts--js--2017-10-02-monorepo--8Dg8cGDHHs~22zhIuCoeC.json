{"data":{"title":"複数環境構築のためにLernaを使う、が","date":"2017-10-02T02:00:00.000Z","permalink":"/entry/2017/10/02/monorepo/","category":"js","_entry":"posts/js/2017-10-02-monorepo.md","page":"post","name":"monorepo","url":"/entry/2017/10/02/monorepo/"},"content":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"TL;DR","position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":8,"offset":8}}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":8,"offset":8}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"期待通りに動かない","position":{"start":{"line":4,"column":3,"offset":12},"end":{"line":4,"column":12,"offset":21}}}],"position":{"start":{"line":4,"column":1,"offset":10},"end":{"line":4,"column":12,"offset":21}}},{"type":"text","value":"\n"}],"position":{"start":{"line":4,"column":1,"offset":10},"end":{"line":4,"column":12,"offset":21}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"npm or yarn","position":{"start":{"line":6,"column":4,"offset":26},"end":{"line":6,"column":15,"offset":37}}}],"position":{"start":{"line":6,"column":1,"offset":23},"end":{"line":6,"column":15,"offset":37}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"npmClientを指定できるようだが、yarnを指定すると永遠にインストールが終わらない問題に出くわす","position":{"start":{"line":8,"column":3,"offset":41},"end":{"line":8,"column":55,"offset":93}}},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://travis-ci.org/9renpoto/eslint-config/builds/281805776"},"children":[{"type":"text","value":"https://travis-ci.org/9renpoto/eslint-config/builds/281805776","position":{"start":{"line":9,"column":6,"offset":99},"end":{"line":9,"column":67,"offset":160}}}],"position":{"start":{"line":9,"column":5,"offset":98},"end":{"line":9,"column":68,"offset":161}}}],"position":{"start":{"line":9,"column":3,"offset":96},"end":{"line":9,"column":68,"offset":161}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"concurrency=1"}],"position":{"start":{"line":10,"column":5,"offset":166},"end":{"line":10,"column":20,"offset":181}}},{"type":"text","value":" を指定するなど試すもretryしてやっと動く程度","position":{"start":{"line":10,"column":20,"offset":181},"end":{"line":10,"column":45,"offset":206}}},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"期待するportに接続できていない？","position":{"start":{"line":11,"column":7,"offset":213},"end":{"line":11,"column":25,"offset":231}}}],"position":{"start":{"line":11,"column":5,"offset":211},"end":{"line":11,"column":25,"offset":231}}},{"type":"text","value":"\n"}],"position":{"start":{"line":11,"column":5,"offset":211},"end":{"line":11,"column":25,"offset":231}}}],"position":{"start":{"line":10,"column":3,"offset":164},"end":{"line":11,"column":25,"offset":231}}},{"type":"text","value":"\n"}],"position":{"start":{"line":9,"column":3,"offset":96},"end":{"line":11,"column":25,"offset":231}}}],"position":{"start":{"line":8,"column":1,"offset":39},"end":{"line":11,"column":25,"offset":231}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"npm v5","position":{"start":{"line":12,"column":3,"offset":234},"end":{"line":12,"column":9,"offset":240}}},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"何故かlernaを通してやると ","position":{"start":{"line":13,"column":5,"offset":245},"end":{"line":13,"column":21,"offset":261}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"dependencies"}],"position":{"start":{"line":13,"column":21,"offset":261},"end":{"line":13,"column":35,"offset":275}}},{"type":"text","value":" がrootに展開されず見つからない場合がある","position":{"start":{"line":13,"column":35,"offset":275},"end":{"line":13,"column":58,"offset":298}}}],"position":{"start":{"line":13,"column":3,"offset":243},"end":{"line":13,"column":58,"offset":298}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ディレクトリ直下でやると問題ない場合がある","position":{"start":{"line":14,"column":5,"offset":303},"end":{"line":14,"column":26,"offset":324}}},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"バグっている気持ち","position":{"start":{"line":15,"column":7,"offset":331},"end":{"line":15,"column":16,"offset":340}}}],"position":{"start":{"line":15,"column":5,"offset":329},"end":{"line":15,"column":16,"offset":340}}},{"type":"text","value":"\n"}],"position":{"start":{"line":15,"column":5,"offset":329},"end":{"line":15,"column":16,"offset":340}}}],"position":{"start":{"line":14,"column":3,"offset":301},"end":{"line":15,"column":16,"offset":340}}},{"type":"text","value":"\n"}],"position":{"start":{"line":13,"column":3,"offset":243},"end":{"line":15,"column":16,"offset":340}}}],"position":{"start":{"line":12,"column":1,"offset":232},"end":{"line":15,"column":16,"offset":340}}},{"type":"text","value":"\n"}],"position":{"start":{"line":8,"column":1,"offset":39},"end":{"line":15,"column":16,"offset":340}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"lerna bootstrap","position":{"start":{"line":17,"column":4,"offset":345},"end":{"line":17,"column":19,"offset":360}}}],"position":{"start":{"line":17,"column":1,"offset":342},"end":{"line":17,"column":19,"offset":360}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"共通packageとは、本当はディレクトリ直下で行いたいができていないようにみえる","position":{"start":{"line":19,"column":3,"offset":364},"end":{"line":19,"column":44,"offset":405}}},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"lerna version 2.2.0","position":{"start":{"line":20,"column":5,"offset":410},"end":{"line":20,"column":24,"offset":429}}}],"position":{"start":{"line":20,"column":3,"offset":408},"end":{"line":20,"column":24,"offset":429}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"結局複数installを求められるものがある？","position":{"start":{"line":21,"column":5,"offset":434},"end":{"line":21,"column":28,"offset":457}}},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"eslint","position":{"start":{"line":22,"column":7,"offset":464},"end":{"line":22,"column":13,"offset":470}}}],"position":{"start":{"line":22,"column":5,"offset":462},"end":{"line":22,"column":13,"offset":470}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"typescript","position":{"start":{"line":23,"column":7,"offset":477},"end":{"line":23,"column":17,"offset":487}}}],"position":{"start":{"line":23,"column":5,"offset":475},"end":{"line":23,"column":17,"offset":487}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"flow-bin","position":{"start":{"line":24,"column":7,"offset":494},"end":{"line":24,"column":15,"offset":502}}}],"position":{"start":{"line":24,"column":5,"offset":492},"end":{"line":24,"column":15,"offset":502}}},{"type":"text","value":"\n"}],"position":{"start":{"line":22,"column":5,"offset":462},"end":{"line":24,"column":15,"offset":502}}}],"position":{"start":{"line":21,"column":3,"offset":432},"end":{"line":24,"column":15,"offset":502}}},{"type":"text","value":"\n"}],"position":{"start":{"line":20,"column":3,"offset":408},"end":{"line":24,"column":15,"offset":502}}}],"position":{"start":{"line":19,"column":1,"offset":362},"end":{"line":24,"column":15,"offset":502}}},{"type":"text","value":"\n"}],"position":{"start":{"line":19,"column":1,"offset":362},"end":{"line":24,"column":15,"offset":502}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"まとめ","position":{"start":{"line":26,"column":4,"offset":507},"end":{"line":26,"column":7,"offset":510}}}],"position":{"start":{"line":26,"column":1,"offset":504},"end":{"line":26,"column":7,"offset":510}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"原因は調べきれていないが、lernaが原因で使えていない問題はいろいろありそう","position":{"start":{"line":28,"column":3,"offset":514},"end":{"line":28,"column":42,"offset":553}}},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"issueは200以上ある","position":{"start":{"line":29,"column":5,"offset":558},"end":{"line":29,"column":18,"offset":571}}}],"position":{"start":{"line":29,"column":3,"offset":556},"end":{"line":29,"column":18,"offset":571}}},{"type":"text","value":"\n"}],"position":{"start":{"line":29,"column":3,"offset":556},"end":{"line":29,"column":18,"offset":571}}}],"position":{"start":{"line":28,"column":1,"offset":512},"end":{"line":29,"column":18,"offset":571}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"早めに地雷を踏んでおく","position":{"start":{"line":30,"column":3,"offset":574},"end":{"line":30,"column":14,"offset":585}}}],"position":{"start":{"line":30,"column":1,"offset":572},"end":{"line":30,"column":14,"offset":585}}},{"type":"text","value":"\n"}],"position":{"start":{"line":28,"column":1,"offset":512},"end":{"line":30,"column":14,"offset":585}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"http://3.bp.blogspot.com/-R1W3888HcbU/V9ppr9A_NHI/AAAAAAAA9wE/CuzJ-JfOQz8Ht6w-jNN79_vh6-TeVOGNACLcB/s800/jirai_tanchiki_man.png","alt":"image"},"children":[],"position":{"start":{"line":32,"column":1,"offset":587},"end":{"line":32,"column":138,"offset":724}}}],"position":{"start":{"line":32,"column":1,"offset":587},"end":{"line":32,"column":138,"offset":724}}}],"data":{"quirksMode":false},"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}}},"raw":"\n# TL;DR\n\n- 期待通りに動かない\n\n## npm or yarn\n\n- npmClientを指定できるようだが、yarnを指定すると永遠にインストールが終わらない問題に出くわす\n  - <https://travis-ci.org/9renpoto/eslint-config/builds/281805776>\n  - `concurrency=1` を指定するなど試すもretryしてやっと動く程度\n    - 期待するportに接続できていない？\n- npm v5\n  - 何故かlernaを通してやると `dependencies` がrootに展開されず見つからない場合がある\n  - ディレクトリ直下でやると問題ない場合がある\n    - バグっている気持ち\n\n## lerna bootstrap\n\n- 共通packageとは、本当はディレクトリ直下で行いたいができていないようにみえる\n  - lerna version 2.2.0\n  - 結局複数installを求められるものがある？\n    - eslint\n    - typescript\n    - flow-bin\n\n## まとめ\n\n- 原因は調べきれていないが、lernaが原因で使えていない問題はいろいろありそう\n  - issueは200以上ある\n- 早めに地雷を踏んでおく\n\n![image](http://3.bp.blogspot.com/-R1W3888HcbU/V9ppr9A_NHI/AAAAAAAA9wE/CuzJ-JfOQz8Ht6w-jNN79_vh6-TeVOGNACLcB/s800/jirai_tanchiki_man.png)\n"}