{"data":{"date":"2017-06-15T15:00:11.000Z","permalink":"/entry/2017/06/16/google-optimize-variation/","title":"google optimize を読む","categories":["javascript"],"_entry":"posts/2017-06-16-google-optimize-variation/index.md","page":"post","name":"index","category":"2017-06-16-google-optimize-variation","url":"/entry/2017/06/16/google-optimize-variation/"},"content":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"TL;DR","position":{"start":{"line":1,"column":3,"offset":2},"end":{"line":1,"column":8,"offset":7}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":8,"offset":7}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"google optimizeで今適応されているテストは何か調べた","position":{"start":{"line":3,"column":3,"offset":11},"end":{"line":3,"column":36,"offset":44}}}],"position":{"start":{"line":3,"column":1,"offset":9},"end":{"line":3,"column":36,"offset":44}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"テストの結果はfirst party cookie","position":{"start":{"line":4,"column":3,"offset":47},"end":{"line":4,"column":28,"offset":72}}}],"position":{"start":{"line":4,"column":1,"offset":45},"end":{"line":4,"column":28,"offset":72}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"_gaexp"}],"position":{"start":{"line":5,"column":3,"offset":75},"end":{"line":5,"column":11,"offset":83}}},{"type":"text","value":"という名前で記録されている","position":{"start":{"line":5,"column":11,"offset":83},"end":{"line":5,"column":24,"offset":96}}}],"position":{"start":{"line":5,"column":1,"offset":73},"end":{"line":5,"column":24,"offset":96}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"規約は読んで自己責任で参照しましょう","position":{"start":{"line":6,"column":5,"offset":101},"end":{"line":6,"column":23,"offset":119}}}],"position":{"start":{"line":6,"column":3,"offset":99},"end":{"line":6,"column":25,"offset":121}}}],"position":{"start":{"line":6,"column":1,"offset":97},"end":{"line":6,"column":25,"offset":121}}},{"type":"text","value":"\n"}],"position":{"start":{"line":3,"column":1,"offset":9},"end":{"line":6,"column":25,"offset":121}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"./google-optimize-logo.jpg","alt":"optimize"},"children":[],"position":{"start":{"line":8,"column":1,"offset":123},"end":{"line":8,"column":40,"offset":162}}}],"position":{"start":{"line":8,"column":1,"offset":123},"end":{"line":8,"column":40,"offset":162}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"軽く調べた結果","position":{"start":{"line":10,"column":4,"offset":167},"end":{"line":10,"column":11,"offset":174}}}],"position":{"start":{"line":10,"column":1,"offset":164},"end":{"line":10,"column":11,"offset":174}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage?hl=en#optimize"},"children":[{"type":"text","value":"公開情報","position":{"start":{"line":12,"column":4,"offset":179},"end":{"line":12,"column":8,"offset":183}}}],"position":{"start":{"line":12,"column":3,"offset":178},"end":{"line":12,"column":111,"offset":286}}}],"position":{"start":{"line":12,"column":3,"offset":178},"end":{"line":12,"column":111,"offset":286}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"_gaexp"}],"position":{"start":{"line":13,"column":5,"offset":291},"end":{"line":13,"column":13,"offset":299}}},{"type":"text","value":"という名前で記録されている","position":{"start":{"line":13,"column":13,"offset":299},"end":{"line":13,"column":26,"offset":312}}}],"position":{"start":{"line":13,"column":3,"offset":289},"end":{"line":13,"column":26,"offset":312}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cookieはデフォルト90日保存","position":{"start":{"line":14,"column":5,"offset":317},"end":{"line":14,"column":22,"offset":334}}}],"position":{"start":{"line":14,"column":3,"offset":315},"end":{"line":14,"column":22,"offset":334}}},{"type":"text","value":"\n"}],"position":{"start":{"line":13,"column":3,"offset":289},"end":{"line":14,"column":22,"offset":334}}},{"type":"text","value":"\n"}],"position":{"start":{"line":12,"column":1,"offset":176},"end":{"line":14,"column":22,"offset":334}}},{"type":"text","value":"\n"}],"position":{"start":{"line":12,"column":1,"offset":176},"end":{"line":14,"column":22,"offset":334}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"おそらく操作しているところ","position":{"start":{"line":16,"column":4,"offset":339},"end":{"line":16,"column":17,"offset":352}}}],"position":{"start":{"line":16,"column":1,"offset":336},"end":{"line":16,"column":17,"offset":352}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"m[0]"}],"position":{"start":{"line":18,"column":3,"offset":356},"end":{"line":18,"column":9,"offset":362}}},{"type":"text","value":" は ","position":{"start":{"line":18,"column":9,"offset":362},"end":{"line":18,"column":12,"offset":365}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"experimentid"}],"position":{"start":{"line":18,"column":12,"offset":365},"end":{"line":18,"column":26,"offset":379}}}],"position":{"start":{"line":18,"column":1,"offset":354},"end":{"line":18,"column":26,"offset":379}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"m[2]"}],"position":{"start":{"line":19,"column":3,"offset":382},"end":{"line":19,"column":9,"offset":388}}},{"type":"text","value":" がテストのパターンを表している","position":{"start":{"line":19,"column":9,"offset":388},"end":{"line":19,"column":25,"offset":404}}}],"position":{"start":{"line":19,"column":3,"offset":382},"end":{"line":19,"column":25,"offset":404}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cookieの一番最後のnumber","position":{"start":{"line":20,"column":5,"offset":409},"end":{"line":20,"column":23,"offset":427}}}],"position":{"start":{"line":20,"column":3,"offset":407},"end":{"line":20,"column":23,"offset":427}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"これだけだと ","position":{"start":{"line":21,"column":5,"offset":432},"end":{"line":21,"column":12,"offset":439}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"variationid"}],"position":{"start":{"line":21,"column":12,"offset":439},"end":{"line":21,"column":25,"offset":452}}},{"type":"text","value":" としては使えないので何かと複合してユニークになっている","position":{"start":{"line":21,"column":25,"offset":452},"end":{"line":21,"column":53,"offset":480}}}],"position":{"start":{"line":21,"column":3,"offset":430},"end":{"line":21,"column":53,"offset":480}}},{"type":"text","value":"\n"}],"position":{"start":{"line":20,"column":3,"offset":407},"end":{"line":21,"column":53,"offset":480}}},{"type":"text","value":"\n"}],"position":{"start":{"line":19,"column":1,"offset":380},"end":{"line":21,"column":53,"offset":480}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"m[1]"}],"position":{"start":{"line":22,"column":3,"offset":483},"end":{"line":22,"column":9,"offset":489}}},{"type":"text","value":" はnumberだが何の値かはすぐにはわからなかった","position":{"start":{"line":22,"column":9,"offset":489},"end":{"line":22,"column":35,"offset":515}}}],"position":{"start":{"line":22,"column":1,"offset":481},"end":{"line":22,"column":35,"offset":515}}},{"type":"text","value":"\n"}],"position":{"start":{"line":18,"column":1,"offset":354},"end":{"line":22,"column":35,"offset":515}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"Zg = function(a, b) {\n  const c = b.match(/GAX1\\.([^.]+).(.*)/)\n  if (c) {\n    let d\n    a: {\n      const e = (c[1] || \"\").split(\"-\")\n      if (!(e.length == 0 || e.length > 2)) {\n        const f = ia(e[0])\n        if (f.length != 0) {\n          const g = e.length == 2 ? ia(e[1]) : \"1\"\n          if (uf(f) && uf(g)) {\n            d = new Og(T(f), T(g))\n            break a\n          }\n        }\n      }\n      d = void 0\n    }\n    if (d) {\n      for (\n        var h = new Qg(d, a.qa, a.ha), k = (c[2] || \"\").split(\"!\"), l = 0;\n        l < k.length;\n        l++\n      ) {\n        const m = k[l].split(\".\")\n        if (m.length == 3) {\n          if (!uf(m[1])) {\n            return\n          }\n          Ug(h, m[0], new Pg(m[2], T(m[1])))\n        }\n      }\n      return h\n    }\n  }\n}\n"}],"position":{"start":{"line":24,"column":1,"offset":517},"end":{"line":61,"column":4,"offset":1308}}}],"position":{"start":{"line":24,"column":1,"offset":517},"end":{"line":61,"column":4,"offset":1308}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Extra","position":{"start":{"line":63,"column":4,"offset":1313},"end":{"line":63,"column":9,"offset":1318}}}],"position":{"start":{"line":63,"column":1,"offset":1310},"end":{"line":63,"column":9,"offset":1318}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://stackoverflow.com/questions/44412241/is-it-possible-to-read-experimentid-and-variationid-in-javascript-with-google-op"},"children":[{"type":"text","value":"stackoverflow","position":{"start":{"line":65,"column":4,"offset":1323},"end":{"line":65,"column":17,"offset":1336}}}],"position":{"start":{"line":65,"column":3,"offset":1322},"end":{"line":65,"column":145,"offset":1464}}}],"position":{"start":{"line":65,"column":3,"offset":1322},"end":{"line":65,"column":145,"offset":1464}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ABテストとしてJavaScriptが実行できるので、自分でユニークなIDを配信して実行されているテストを特定しましょう","position":{"start":{"line":66,"column":5,"offset":1469},"end":{"line":66,"column":65,"offset":1529}}}],"position":{"start":{"line":66,"column":3,"offset":1467},"end":{"line":66,"column":65,"offset":1529}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"リバースエンジニアリングして危ない道を渡るよりも現実的","position":{"start":{"line":67,"column":5,"offset":1534},"end":{"line":67,"column":32,"offset":1561}}}],"position":{"start":{"line":67,"column":3,"offset":1532},"end":{"line":67,"column":32,"offset":1561}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ちゃんとABテストの記録は計測できます、そうgoogle analyticsならね！","position":{"start":{"line":68,"column":5,"offset":1566},"end":{"line":68,"column":47,"offset":1608}}}],"position":{"start":{"line":68,"column":3,"offset":1564},"end":{"line":68,"column":47,"offset":1608}}},{"type":"text","value":"\n"}],"position":{"start":{"line":66,"column":3,"offset":1467},"end":{"line":68,"column":47,"offset":1608}}},{"type":"text","value":"\n"}],"position":{"start":{"line":65,"column":1,"offset":1320},"end":{"line":68,"column":47,"offset":1608}}},{"type":"text","value":"\n"}],"position":{"start":{"line":65,"column":1,"offset":1320},"end":{"line":68,"column":47,"offset":1608}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Happy Hacking!","position":{"start":{"line":70,"column":1,"offset":1610},"end":{"line":70,"column":15,"offset":1624}}}],"position":{"start":{"line":70,"column":1,"offset":1610},"end":{"line":70,"column":15,"offset":1624}}}],"data":{"quirksMode":false},"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":1,"offset":0}}},"raw":"# TL;DR\n\n- google optimizeで今適応されているテストは何か調べた\n- テストの結果はfirst party cookie\n- `_gaexp`という名前で記録されている\n- **規約は読んで自己責任で参照しましょう**\n\n![optimize](./google-optimize-logo.jpg)\n\n## 軽く調べた結果\n\n- [公開情報](https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage?hl=en#optimize)\n  - `_gaexp`という名前で記録されている\n  - cookieはデフォルト90日保存\n\n## おそらく操作しているところ\n\n- `m[0]` は `experimentid`\n- `m[2]` がテストのパターンを表している\n  - cookieの一番最後のnumber\n  - これだけだと `variationid` としては使えないので何かと複合してユニークになっている\n- `m[1]` はnumberだが何の値かはすぐにはわからなかった\n\n```js\nZg = function(a, b) {\n  const c = b.match(/GAX1\\.([^.]+).(.*)/)\n  if (c) {\n    let d\n    a: {\n      const e = (c[1] || \"\").split(\"-\")\n      if (!(e.length == 0 || e.length > 2)) {\n        const f = ia(e[0])\n        if (f.length != 0) {\n          const g = e.length == 2 ? ia(e[1]) : \"1\"\n          if (uf(f) && uf(g)) {\n            d = new Og(T(f), T(g))\n            break a\n          }\n        }\n      }\n      d = void 0\n    }\n    if (d) {\n      for (\n        var h = new Qg(d, a.qa, a.ha), k = (c[2] || \"\").split(\"!\"), l = 0;\n        l < k.length;\n        l++\n      ) {\n        const m = k[l].split(\".\")\n        if (m.length == 3) {\n          if (!uf(m[1])) {\n            return\n          }\n          Ug(h, m[0], new Pg(m[2], T(m[1])))\n        }\n      }\n      return h\n    }\n  }\n}\n```\n\n## Extra\n\n- [stackoverflow](https://stackoverflow.com/questions/44412241/is-it-possible-to-read-experimentid-and-variationid-in-javascript-with-google-op)\n  - ABテストとしてJavaScriptが実行できるので、自分でユニークなIDを配信して実行されているテストを特定しましょう\n  - リバースエンジニアリングして危ない道を渡るよりも現実的\n  - ちゃんとABテストの記録は計測できます、そうgoogle analyticsならね！\n\nHappy Hacking!\n"}