<!DOCTYPE html><html><head><meta charSet="utf-8" class="next-head"/><title class="next-head">:-) google optimize を読む</title><link rel="stylesheet" href="/static/bundle.css" class="next-head"/><link rel="preload" href="/_next/1ae5b7d6-c7b0-4707-9d6f-287103c21939/page/post.js" as="script"/><link rel="preload" href="/_next/1ae5b7d6-c7b0-4707-9d6f-287103c21939/page/_error.js" as="script"/><link rel="preload" href="/_next/75f39d178f2ad03edc997c4ec0b23dd5/app.js" as="script"/></head><body><div><div id="__next"><div data-reactroot=""><div><header class="navbar"><div class="navbar-brand"><a class="navbar-item" href="/">:-)</a><div class="navbar-burger burger" data-target="navMenu"><span></span><span></span><span></span></div></div><div class="navbar-menu" id="navMenu"><div class="navbar-end"><a class="navbar-item" href="https://9renpoto.github.io/entry/tags/">tags</a><a class="navbar-item" href="https://9renpoto.github.io/entry/profile/">profile</a></div></div></header><section class="hero is-primary"><div class="hero-body"><div class="container"><h1 class="title">google optimize を読む</h1></div></div></section><section class="section"><div class="container is-fluid"><div class="content"><div><h1>TL;DR</h1>
<ul>
<li>google optimizeで今適応されているテストは何か調べた</li>
<li>テストの結果はfirst party cookie</li>
<li><code>_gaexp</code>という名前で記録されている</li>
<li><strong>規約は読んで自己責任で参照しましょう</strong></li>
</ul>
<p><img src="./google-optimize-logo.jpg" alt="optimize"/></p>
<h2>軽く調べた結果</h2>
<ul>
<li>
<p><a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage?hl=en#optimize">公開情報</a></p>
<ul>
<li><code>_gaexp</code>という名前で記録されている</li>
<li>cookieはデフォルト90日保存</li>
</ul>
</li>
</ul>
<h2>おそらく操作しているところ</h2>
<ul>
<li><code>m[0]</code> は <code>experimentid</code></li>
<li>
<p><code>m[2]</code> がテストのパターンを表している</p>
<ul>
<li>cookieの一番最後のnumber</li>
<li>これだけだと <code>variationid</code> としては使えないので何かと複合してユニークになっている</li>
</ul>
</li>
<li><code>m[1]</code> はnumberだが何の値かはすぐにはわからなかった</li>
</ul>
<pre><code class="language-js">Zg = function(a, b) {
  const c = b.match(/GAX1\.([^.]+).(.*)/)
  if (c) {
    let d
    a: {
      const e = (c[1] || &quot;&quot;).split(&quot;-&quot;)
      if (!(e.length == 0 || e.length &gt; 2)) {
        const f = ia(e[0])
        if (f.length != 0) {
          const g = e.length == 2 ? ia(e[1]) : &quot;1&quot;
          if (uf(f) &amp;&amp; uf(g)) {
            d = new Og(T(f), T(g))
            break a
          }
        }
      }
      d = void 0
    }
    if (d) {
      for (
        var h = new Qg(d, a.qa, a.ha), k = (c[2] || &quot;&quot;).split(&quot;!&quot;), l = 0;
        l &lt; k.length;
        l++
      ) {
        const m = k[l].split(&quot;.&quot;)
        if (m.length == 3) {
          if (!uf(m[1])) {
            return
          }
          Ug(h, m[0], new Pg(m[2], T(m[1])))
        }
      }
      return h
    }
  }
}
</code></pre>
<h2>Extra</h2>
<ul>
<li>
<p><a href="https://stackoverflow.com/questions/44412241/is-it-possible-to-read-experimentid-and-variationid-in-javascript-with-google-op">stackoverflow</a></p>
<ul>
<li>ABテストとしてJavaScriptが実行できるので、自分でユニークなIDを配信して実行されているテストを特定しましょう</li>
<li>リバースエンジニアリングして危ない道を渡るよりも現実的</li>
<li>ちゃんとABテストの記録は計測できます、そうgoogle analyticsならね！</li>
</ul>
</li>
</ul>
<p>Happy Hacking!</p></div></div></div></section></div></div></div><div id="__next-error"></div></div><div><script>
          __NEXT_DATA__ = {"props":{"post":{"data":{"date":"2017-06-15T15:00:11.000Z","permalink":"/entry/2017/06/16/google-optimize-variation/","title":"google optimize を読む","categories":["javascript"],"page":"post","_entry":"posts/2017-06-16-google-optimize-variation/index.md","name":"index","category":"2017-06-16-google-optimize-variation","url":"/entry/2017/06/16/google-optimize-variation/"},"content":"# TL;DR\n\n- google optimizeで今適応されているテストは何か調べた\n- テストの結果はfirst party cookie\n- `_gaexp`という名前で記録されている\n- **規約は読んで自己責任で参照しましょう**\n\n![optimize](./google-optimize-logo.jpg)\n\n## 軽く調べた結果\n\n- [公開情報](https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage?hl=en#optimize)\n  - `_gaexp`という名前で記録されている\n  - cookieはデフォルト90日保存\n\n## おそらく操作しているところ\n\n- `m[0]` は `experimentid`\n- `m[2]` がテストのパターンを表している\n  - cookieの一番最後のnumber\n  - これだけだと `variationid` としては使えないので何かと複合してユニークになっている\n- `m[1]` はnumberだが何の値かはすぐにはわからなかった\n\n```js\nZg = function(a, b) {\n  const c = b.match(/GAX1\\.([^.]+).(.*)/)\n  if (c) {\n    let d\n    a: {\n      const e = (c[1] || \"\").split(\"-\")\n      if (!(e.length == 0 || e.length \u003e 2)) {\n        const f = ia(e[0])\n        if (f.length != 0) {\n          const g = e.length == 2 ? ia(e[1]) : \"1\"\n          if (uf(f) \u0026\u0026 uf(g)) {\n            d = new Og(T(f), T(g))\n            break a\n          }\n        }\n      }\n      d = void 0\n    }\n    if (d) {\n      for (\n        var h = new Qg(d, a.qa, a.ha), k = (c[2] || \"\").split(\"!\"), l = 0;\n        l \u003c k.length;\n        l++\n      ) {\n        const m = k[l].split(\".\")\n        if (m.length == 3) {\n          if (!uf(m[1])) {\n            return\n          }\n          Ug(h, m[0], new Pg(m[2], T(m[1])))\n        }\n      }\n      return h\n    }\n  }\n}\n```\n\n## Extra\n\n- [stackoverflow](https://stackoverflow.com/questions/44412241/is-it-possible-to-read-experimentid-and-variationid-in-javascript-with-google-op)\n  - ABテストとしてJavaScriptが実行できるので、自分でユニークなIDを配信して実行されているテストを特定しましょう\n  - リバースエンジニアリングして危ない道を渡るよりも現実的\n  - ちゃんとABテストの記録は計測できます、そうgoogle analyticsならね！\n\nHappy Hacking!\n"}},"pathname":"/post","query":{"_entry":"posts/2017-06-16-google-optimize-variation/index.md"},"buildId":"1ae5b7d6-c7b0-4707-9d6f-287103c21939","buildStats":{"app.js":{"hash":"75f39d178f2ad03edc997c4ec0b23dd5"}},"assetPrefix":"","nextExport":true,"err":null,"chunks":[]}
          module={}
          __NEXT_LOADED_PAGES__ = []
          __NEXT_LOADED_CHUNKS__ = []

          __NEXT_REGISTER_PAGE = function (route, fn) {
            __NEXT_LOADED_PAGES__.push({ route: route, fn: fn })
          }

          __NEXT_REGISTER_CHUNK = function (chunkName, fn) {
            __NEXT_LOADED_CHUNKS__.push({ chunkName: chunkName, fn: fn })
          }
        </script><script async="" id="__NEXT_PAGE__/post" type="text/javascript" src="/_next/1ae5b7d6-c7b0-4707-9d6f-287103c21939/page/post.js"></script><script async="" id="__NEXT_PAGE__/_error" type="text/javascript" src="/_next/1ae5b7d6-c7b0-4707-9d6f-287103c21939/page/_error.js"></script><div></div><script type="text/javascript" src="/_next/75f39d178f2ad03edc997c4ec0b23dd5/app.js" async=""></script></div></body></html>