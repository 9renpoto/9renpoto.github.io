{"data":{"date":"2017-06-15T15:00:11.000Z","permalink":"/entry/2017/06/16/google-optimize-variation/","title":"google optimize を読む","category":"js","_entry":"posts/js/2017-06-16-google-optimize-variation.md","page":"post","name":"google-optimize-variation","url":"/entry/2017/06/16/google-optimize-variation/"},"content":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"TL;DR"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"google optimizeで今適応されているテストは何か調べた"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"テストの結果はfirst party cookie"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"_gaexp"}]},{"type":"text","value":"という名前で記録されている"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"規約は読んで自己責任で参照しましょう"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"img","properties":{"src":"/static/google-optimize-logo.jpg","alt":"optimize"},"children":[]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"軽く調べた結果"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage?hl=en#optimize"},"children":[{"type":"text","value":"公開情報"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"_gaexp"}]},{"type":"text","value":"という名前で記録されている"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cookieはデフォルト90日保存"}]},{"type":"text","value":"\n"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"おそらく操作しているところ"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"m[0]"}]},{"type":"text","value":" は "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"experimentid"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"m[2]"}]},{"type":"text","value":" がテストのパターンを表している"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cookieの一番最後のnumber"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"これだけだと "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"variationid"}]},{"type":"text","value":" としては使えないので何かと複合してユニークになっている"}]},{"type":"text","value":"\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"m[1]"}]},{"type":"text","value":" はnumberだが何の値かはすぐにはわからなかった"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"Zg = function(a, b) {\n  const c = b.match(/GAX1\\.([^.]+).(.*)/);\n  if (c) {\n    let d;\n    a: {\n      const e = (c[1] || \"\").split(\"-\");\n      if (!(e.length == 0 || e.length > 2)) {\n        const f = ia(e[0]);\n        if (f.length != 0) {\n          const g = e.length == 2 ? ia(e[1]) : \"1\";\n          if (uf(f) && uf(g)) {\n            d = new Og(T(f), T(g));\n            break a;\n          }\n        }\n      }\n      d = void 0;\n    }\n    if (d) {\n      for (\n        var h = new Qg(d, a.qa, a.ha), k = (c[2] || \"\").split(\"!\"), l = 0;\n        l < k.length;\n        l++\n      ) {\n        const m = k[l].split(\".\");\n        if (m.length == 3) {\n          if (!uf(m[1])) {\n            return;\n          }\n          Ug(h, m[0], new Pg(m[2], T(m[1])));\n        }\n      }\n      return h;\n    }\n  }\n};\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Extra"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://stackoverflow.com/questions/44412241/is-it-possible-to-read-experimentid-and-variationid-in-javascript-with-google-op"},"children":[{"type":"text","value":"stackoverflow"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ABテストとしてJavaScriptが実行できるので、自分でユニークなIDを配信して実行されているテストを特定しましょう"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"リバースエンジニアリングして危ない道を渡るよりも現実的"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ちゃんとABテストの記録は計測できます、そうgoogle analyticsならね！"}]},{"type":"text","value":"\n"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Happy Hacking!"}]}],"data":{"quirksMode":false}},"raw":"\n# TL;DR\n\n- google optimizeで今適応されているテストは何か調べた\n- テストの結果はfirst party cookie\n- `_gaexp`という名前で記録されている\n- **規約は読んで自己責任で参照しましょう**\n\n![optimize](/static/google-optimize-logo.jpg)\n\n## 軽く調べた結果\n\n- [公開情報](https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage?hl=en#optimize)\n  - `_gaexp`という名前で記録されている\n  - cookieはデフォルト90日保存\n\n## おそらく操作しているところ\n\n- `m[0]` は `experimentid`\n- `m[2]` がテストのパターンを表している\n  - cookieの一番最後のnumber\n  - これだけだと `variationid` としては使えないので何かと複合してユニークになっている\n- `m[1]` はnumberだが何の値かはすぐにはわからなかった\n\n```js\nZg = function(a, b) {\n  const c = b.match(/GAX1\\.([^.]+).(.*)/);\n  if (c) {\n    let d;\n    a: {\n      const e = (c[1] || \"\").split(\"-\");\n      if (!(e.length == 0 || e.length > 2)) {\n        const f = ia(e[0]);\n        if (f.length != 0) {\n          const g = e.length == 2 ? ia(e[1]) : \"1\";\n          if (uf(f) && uf(g)) {\n            d = new Og(T(f), T(g));\n            break a;\n          }\n        }\n      }\n      d = void 0;\n    }\n    if (d) {\n      for (\n        var h = new Qg(d, a.qa, a.ha), k = (c[2] || \"\").split(\"!\"), l = 0;\n        l < k.length;\n        l++\n      ) {\n        const m = k[l].split(\".\");\n        if (m.length == 3) {\n          if (!uf(m[1])) {\n            return;\n          }\n          Ug(h, m[0], new Pg(m[2], T(m[1])));\n        }\n      }\n      return h;\n    }\n  }\n};\n```\n\n## Extra\n\n- [stackoverflow](https://stackoverflow.com/questions/44412241/is-it-possible-to-read-experimentid-and-variationid-in-javascript-with-google-op)\n  - ABテストとしてJavaScriptが実行できるので、自分でユニークなIDを配信して実行されているテストを特定しましょう\n  - リバースエンジニアリングして危ない道を渡るよりも現実的\n  - ちゃんとABテストの記録は計測できます、そうgoogle analyticsならね！\n\nHappy Hacking!\n"}